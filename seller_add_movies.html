<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Movies - SRH Movies</title>
    <link rel="stylesheet" href="./css/seller_add_movies.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="nav-container">
            <a href="index.html"><div class="logo">SRH <span>Movies</span></div></a>
            <nav>
                <a href="login_page.html" onclick="localStorage.removeItem('userEmail'); localStorage.removeItem('userRole'); sessionStorage.clear(); window.location.replace('login_page.html'); return false;"><button>Logout</button></a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <h1>Add Movies</h1>
        <div class="content-container">
            <!-- Form Section -->
            <div class="form-section">
                <form id="movieForm">
                    <label>Movie Name</label>
                    <input type="text" id="movieName" placeholder="Enter movie name" required>

                    <label>Genre</label>
                    <select id="genre" name="genre">
                        <option>Action</option>
                        <option>Thriller</option>
                        <option>Comedy</option>
                        <option>Romance</option>
                        <option>Horror</option>
                    </select>

                    <label>Description</label>
                    <textarea id="description" placeholder="Enter movie description" required></textarea>

                    <label>Release Date</label>
                    <input type="text" id="releaseDate" placeholder="DD/MM/YYYY" required>

                    <label>Image Location</label>
                    <input type="text" id="image" placeholder="Enter image path" required>

                    <label>Theater</label>
                    <select id="theater" name="theater" multiple>
                        <option>SRH Leipzig Theatre</option>
                        <option>SRH Berlin Theatre</option>
                    </select>

                    <label>Show Times</label>
                    <select id="showTime" name="show-time" multiple>
                        <option>13:00</option>
                        <option>16:00</option>
                        <option>21:00</option>
                    </select>

                    <label>Days</label>
                    <select id="day" name="day" multiple>
                        <option>Monday</option>
                        <option>Tuesday</option>
                        <option>Wednesday</option>
                        <option>Thursday</option>
                        <option>Friday</option>
                        <option>Saturday</option>
                        <option>Sunday</option>
                    </select>

                    <button type="button" id="addMovieButton">Add Details</button>
                </form>
            </div>
        </div>

        <!-- Table Section -->
        <div class="table-section">
            <table id="movieTable">
                <thead>
                    <tr>
                        <th>Sr. No</th>
                        <th>Movie Name</th>
                        <th>Genre</th>
                        <th>Description</th>
                        <th>Release Date</th>
                        <th>Image Path</th>
                        <th>Theater</th>
                        <th>Show Time</th>
                        <th>Day</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamic rows will be added here -->
                </tbody>
            </table>
            <button type="button" id="saveChangesButton">Save Changes</button>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <nav>
                <a href="#">Product</a>
                <a href="#">Features</a>
                <a href="#">Resources</a>
                <a href="#">About</a>
                <a href="#">Blog</a>
                <a href="#">Support</a>
            </nav>
            <div class="logo-text">LOGO</div>
            <p>©️ 2010 – 2020 Privacy – Terms</p>
        </div>
    </footer>

    <!-- Inline JavaScript -->
    <script>
        const movieTableBody = document.querySelector("#movieTable tbody");
        const addMovieButton = document.getElementById("addMovieButton");
        const saveChangesButton = document.getElementById("saveChangesButton");
        const userEmail = localStorage.getItem("userEmail");

        let movieList = [];
        let movieCounter = 1;

        addMovieButton.addEventListener("click", () => {
            const movieName = document.getElementById("movieName").value;
            const genre = document.getElementById("genre").value;
            const description = document.getElementById("description").value;
            let releaseDate = document.getElementById("releaseDate").value;
            const image_path = document.getElementById("image").value
            const theater = Array.from(document.getElementById("theater").selectedOptions).map(option => option.value);
            const selectedShowTimes = Array.from(document.getElementById("showTime").selectedOptions).map(option => option.value);
            const selectedDays = Array.from(document.getElementById("day").selectedOptions).map(option => option.value);

            if (!movieName || !description || !releaseDate || selectedShowTimes.length === 0 || selectedDays.length === 0) {
                alert("Please fill out all required fields.");
                return;
            }

            // Convert releaseDate to YYYY-MM-DD format
            const [day, month, year] = releaseDate.split("/");
            releaseDate = `${year}-${month}-${day}`;

            const movieData = {
                movieName,
                genre,
                description,
                releaseDate,
                image_path,
                userEmail,
                theater,
                showTimes: selectedShowTimes,
                days: selectedDays
            };
            console.log(movieData)

            movieList.push(movieData);

            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${movieCounter}</td>
                <td>${movieName}</td>
                <td>${genre}</td>
                <td>${description}</td>
                <td>${releaseDate}</td>
                <td>${image_path}</td>
                <td>${theater}</td>
                <td>${selectedShowTimes.join(", ")}</td>
                <td>${selectedDays.join(", ")}</td>
            `;
            movieTableBody.appendChild(row);

            movieCounter++;
            document.getElementById("movieForm").reset();
        });

        // Save all movies to backend
        saveChangesButton.addEventListener("click", () => {
            if (movieList.length === 0) {
                alert("No movies to save!");
                return;
            }

            fetch("http://localhost:3000/add_movies", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ movies: movieList }),
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    alert("Movies saved successfully!");
                    movieList = []; // Clear the local list
                } else {
                    alert("Failed to save movies: " + data.message);
                }
            })
            .catch((error) => {
                console.error("Error saving movies:", error);
                alert("An error occurred while saving the movies.");
            });
        });
    </script>
</body>
</html>